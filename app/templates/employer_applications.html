{% extends 'userbase.html' %}

{% block title %}Manage Applications{% endblock %}
{% set active_page = 'home' %}

{% block content %}
<section class="container my-5">
    <h2 class="text-center mb-4">Applications for Your Internships</h2>

    <!-- Search Form -->
    <form method="GET" class="row g-3 mb-4">
        <div class="col-md-4">
            <input type="text" name="name" class="form-control" placeholder="Search by Student Name" value="{{ request.args.get('name', '') }}">
        </div>
        <div class="col-md-4">
            <input type="text" name="title" class="form-control" placeholder="Search by Internship Title" value="{{ request.args.get('title', '') }}">
        </div>
        <div class="col-md-4">
            <select name="status" class="form-select">
                <option value="">All Statuses</option>
                <option value="Pending" {% if request.args.get('status') == 'Pending' %}selected{% endif %}>Pending</option>
                <option value="Accepted" {% if request.args.get('status') == 'Accepted' %}selected{% endif %}>Accepted</option>
                <option value="Rejected" {% if request.args.get('status') == 'Rejected' %}selected{% endif %}>Rejected</option>
            </select>
        </div>
        <div class="col-12 text-end">
            <button type="submit" class="btn btn-success">Search</button>
        </div>
    </form>

    {% if applications %}
    <form method="POST">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Internship Title</th>
                    <th>Status</th>
                    <th>Feedback</th>
                    <th>Cover Letter</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for app in applications %}
                <tr>
                    <form method="POST" action="{{ url_for('view_applications') }}"></form>
                        <td>{{ app.full_name }}</td>
                        <td>{{ app.title }}</td>
                        <td>
                            <select name="status" class="form-select">
                                <option value="Pending" {% if app.status == 'Pending' %}selected{% endif %}>Pending</option>
                                <option value="Accepted" {% if app.status == 'Accepted' %}selected{% endif %}>Accepted</option>
                                <option value="Rejected" {% if app.status == 'Rejected' %}selected{% endif %}>Rejected</option>
                            </select>
                        </td>
                        <td>
                        <textarea name="feedback" rows="2" class="form-control">{{ app.feedback or '' }}</textarea>
                        </td>
                        <td style="white-space: pre-wrap;">{{ app.cover_letter or 'N/A' }}</td>
                        <td>
                            <input type="hidden" name="student_id" value="{{ app.student_id }}">
                            <input type="hidden" name="internship_id" value="{{ app.internship_id }}">
                            <button type="submit" class="btn btn-success btn-sm">Update</button>
                        </td>
                    </form>    
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </form>
    {% else %}
        <p class="text-muted">No applications found for your internships.</p>
    {% endif %}
</section>
{% endblock %}